from ENV import *
from colorama import init
from colorama import Fore, Back, Style
from maximise_console import *

init()
maximize_console()


print(f'''{Fore.GREEN}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%{Style.RESET_ALL}
{Fore.YELLOW}
                                                    $$\       $$$$$$\  $$$$$$\  $$\   $$\ $$$$$$\ $$$$$$$\  $$$$$$$$\ $$\   $$\ $$\      $$\   $$\ 
                                                    $$ |      \_$$  _|$$  __$$\ $$ |  $$ |\_$$  _|$$  __$$\ \____$$  |$$ |  $$ |$$ |     $$ |  $$ |
                                                    $$ |        $$ |  $$ /  $$ |$$ |  $$ |  $$ |  $$ |  $$ |    $$  / $$ |  $$ |$$ |     $$ |  $$ |  
                                                    $$ |        $$ |  $$ |  $$ |$$ |  $$ |  $$ |  $$ |  $$ |   $$  /  $$ |  $$ |$$ |     $$ |  $$ |
                                                    $$ |        $$ |  $$ |  $$ |$$ |  $$ |  $$ |  $$ |  $$ |  $$  /   $$ |  $$ |$$ |     $$ |  $$ |
                                                    $$ |        $$ |  $$ $$\$$ |$$ |  $$ |  $$ |  $$ |  $$ | $$  /    $$ |  $$ |$$ |     $$ |  $$ |
                                                    $$$$$$$$\ $$$$$$\ \$$$$$$ / \$$$$$$  |$$$$$$\ $$$$$$$  |$$$$$$$$\ \$$$$$$  |$$$$$$$$\\\$$$$$$  |
                                                    \________|\______| \___$$$\  \______/ \______|\_______/ \________| \______/ \________|\______/ 
                                                                        \___|                                                                   
                                                                                                                                
{Fore.GREEN}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%{Style.RESET_ALL}
{Fore.YELLOW}
$$\     $$\ $$$$$$$$\       $$$$$$$\  $$$$$$$$\  $$$$$$\   $$$$$$\  $$$$$$$\  $$$$$$\ $$$$$$$\ $$$$$$$$\ $$$$$$\  $$$$$$\  $$\   $$\       $$\   $$\ $$$$$$$$\ $$\       $$$$$$$\  $$$$$$$$\ $$$$$$$\  
\$$\   $$  |\__$$  __|      $$  __$$\ $$  _____|$$  __$$\ $$  __$$\ $$  __$$\ \_$$  _|$$  __$$\\\__$$  __|\_$$  _|$$  __$$\ $$$\  $$ |      $$ |  $$ |$$  _____|$$ |      $$  __$$\ $$  _____|$$  __$$\ 
 \$$\ $$  /    $$ |         $$ |  $$ |$$ |      $$ /  \__|$$ /  \__|$$ |  $$ |  $$ |  $$ |  $$ |  $$ |     $$ |  $$ /  $$ |$$$$\ $$ |      $$ |  $$ |$$ |      $$ |      $$ |  $$ |$$ |      $$ |  $$ |
  \$$$$  /     $$ |         $$ |  $$ |$$$$$\    \$$$$$$\  $$ |      $$$$$$$  |  $$ |  $$$$$$$  |  $$ |     $$ |  $$ |  $$ |$$ $$\$$ |      $$$$$$$$ |$$$$$\    $$ |      $$$$$$$  |$$$$$\    $$$$$$$  |
   \$$  /      $$ |         $$ |  $$ |$$  __|    \____$$\ $$ |      $$  __$$<   $$ |  $$  ____/   $$ |     $$ |  $$ |  $$ |$$ \$$$$ |      $$  __$$ |$$  __|   $$ |      $$  ____/ $$  __|   $$  __$$< 
    $$ |       $$ |         $$ |  $$ |$$ |      $$\   $$ |$$ |  $$\ $$ |  $$ |  $$ |  $$ |        $$ |     $$ |  $$ |  $$ |$$ |\$$$ |      $$ |  $$ |$$ |      $$ |      $$ |      $$ |      $$ |  $$ |
    $$ |       $$ |         $$$$$$$  |$$$$$$$$\ \$$$$$$  |\$$$$$$  |$$ |  $$ |$$$$$$\ $$ |        $$ |   $$$$$$\  $$$$$$  |$$ | \$$ |      $$ |  $$ |$$$$$$$$\ $$$$$$$$\ $$ |      $$$$$$$$\ $$ |  $$ |
    \__|       \__|         \_______/ \________| \______/  \______/ \__|  \__|\______|\__|        \__|   \______| \______/ \__|  \__|      \__|  \__|\________|\________|\__|      \________|\__|  \__|
    
{Fore.GREEN}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%{Style.RESET_ALL}\n\n\n''')

def main():

    cont   = True
    cats   = 0
    catmap = []
    catarr = [[] for x in range(len(ENV))]
    _input = 'What category do you want to add to?\n'
    

    def process(x: int):

        if x == cats:
            return kill()

        if (ENV[catmap[x]][TYPE] & FORMATTED) | (ENV[catmap[x]][TYPE] ^ FORMATTED) == FORMATTED:
            catarr[catmap[x]].append([
                input(ENV[catmap[x]][TIME_Q]),
                input(ENV[catmap[x]][NAME_Q])
            ])

        elif ENV[catmap[x]][TYPE] & DEFAULTS:

            defaultsList = ''
            n_defs       = len(ENV[catmap[x]][DEFLIST]) - 1

            for i in range(n_defs - 1):
                defaultsList += f'''\t{i} => {ENV[catmap[x]][DEFLIST][i+1][DEFLIST_TITLE]}\n'''

            defaultsList += f'\t{n_defs - 1} => {Style.DIM}Custom...{Style.RESET_ALL}'
            _index = [input(ENV[catmap[x]][TIME_Q])]
            option = int(input(f'{ENV[catmap[x]][DEFLIST][DEFLIST_TITLE]}{defaultsList}\n\n')) + DEFLIST_TITLE + 1

            if option < n_defs - 1:
                for d in ENV[catmap[x]][DEFLIST][option]:
                    _index.append(d)
            else:
                for d in input(ENV[catmap[x]][DEFLIST][n_defs]).split(CUSTOM_DEFAULT_DELIMITER):
                    _index.append(d)

            catarr[catmap[x]].append(_index)
        
        return True
    

    def kill():

        desc = ''

        for i in range(len(catarr)):

            if ENV[i][TYPE] == PLAINTEXT:
                desc += ENV[i][PLAINTEXT_TEXT]
            
            elif ENV[i][TYPE] & FORMATTED and catarr[i] != []:

                desc += ENV[i][TITLE]

                for j in range(len(catarr[i])):

                    for k in range(len(catarr[i][j])):

                        if k < len(catarr[i][j]) - 1:
                            desc += f'{catarr[i][j][k]} {DESCRIPTION_DELIMITER} '
                        else:
                            desc += f'{catarr[i][j][k]}'
                        
                            if j < len(catarr[i]) - 1:
                                desc += '\n'
                    

        print(desc)

        while True:
            input('\n\nPress enter to kill program...')
            break
        return False


    for i in range(len(ENV)):
        if ENV[i][TYPE] & FORMATTED:
            catmap.append(i)
            _input += f'\n\t{cats} => {ENV[i][NICK]}'
            cats += 1
    
    _input += f'\n\t{cats} => stop program\n'


    while cont:

        try:
            cont = process(
                int(
                    input(_input)
                )
            )
        
        except KeyboardInterrupt:
            cont = kill()
        
        except ValueError:
            cont = kill()
        
        except KeyError:
            print(
                '''
                *************************
                *************************
                ***** INVALID INDEX *****
                *************************
                *************************
                '''
            )
        

main()
